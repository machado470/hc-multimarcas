<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pagamento - HC Multimarcas</title>
  <meta name="description" content="Finalize sua compra com Pix ou Cartão.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root{ --y:#FFD700; --o:#FFA500; }
    .btn-primary{ background: linear-gradient(135deg, var(--y), var(--o)); color:#111; border-radius: 14px; font-weight:600; padding:.875rem 1.25rem; display:inline-flex; gap:.5rem; align-items:center }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-white border-b">
    <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold">HC <span style="background:linear-gradient(135deg,#FFD700,#FFA500);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent">Multimarcas</span></a>
      <nav class="hidden md:flex items-center gap-4 text-sm">
        <a href="index.html#inicio" class="hover:text-yellow-600">Início</a>
        <a href="index.html#categorias" class="hover:text-yellow-600">Catálogo</a>
        <a href="index.html#ofertas" class="hover:text-yellow-600">Promoções</a>
        <a href="index.html#contato" class="hover:text-yellow-600">Contato</a>
      </nav>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-yellow-700 mb-2">Finalizar Pagamento</h1>
    <p class="text-gray-600 mb-6">Confira seu pedido e preencha os dados abaixo.</p>

    <section class="bg-white rounded-2xl shadow p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">Resumo do Pedido</h2>
      <div id="order-summary" class="space-y-2 text-sm"></div>
      <div class="flex items-center justify-between font-bold text-lg border-t pt-3 mt-3">
        <span>Total</span><span id="order-total">R$ 0,00</span>
      </div>
    </section>

    <form id="payment-form" class="bg-white rounded-2xl shadow p-6 space-y-4">
      <div class="grid md:grid-cols-2 gap-4">
        <input id="nome" class="border rounded-lg px-4 py-3 w-full focus:ring-2 focus:ring-yellow-500" placeholder="Nome completo" required>
        <input id="email" type="email" class="border rounded-lg px-4 py-3 w-full focus:ring-2 focus:ring-yellow-500" placeholder="Email" required>
        <input id="endereco" class="border rounded-lg px-4 py-3 w-full focus:ring-2 focus:ring-yellow-500 md:col-span-2" placeholder="Endereço completo" required>
        <div class="grid grid-cols-2 gap-3 md:col-span-2">
          <input id="cidade" class="border rounded-lg px-4 py-3 w-full focus:ring-2 focus:ring-yellow-500" placeholder="Cidade" required>
          <input id="uf" maxlength="2" class="border rounded-lg px-4 py-3 w-full focus:ring-2 focus:ring-yellow-500" placeholder="UF" required>
        </div>
        <div class="grid grid-cols-3 gap-3 md:col-span-2">
          <input id="cep2" class="border rounded-lg px-4 py-3 w-full focus:ring-2 focus:ring-yellow-500 col-span-2" placeholder="CEP" maxlength="9" required>
          <button id="calc-frete" type="button" class="px-4 py-3 rounded-lg bg-gray-900 text-white">Calcular frete</button>
        </div>
        <div id="frete-info" class="hidden md:col-span-2 text-sm text-gray-700">Frete: <span id="frete-val" class="font-semibold">R$ 0,00</span> • Prazo: <span id="frete-days" class="font-semibold">0 dia(s)</span></div>
      </div>

      <div class="rounded-xl border border-gray-200 p-4">
        <p class="text-sm font-semibold mb-2">Pagamento</p>
        <div class="flex gap-2 mb-3">
          <button class="px-3 py-2 rounded-lg bg-gray-900 text-white" type="button" data-paytab="pix">Pix</button>
          <button class="px-3 py-2 rounded-lg bg-gray-100" type="button" data-paytab="card">Cartão</button>
        </div>
        <div id="pay-pix" class="space-y-2">
          <p class="text-sm text-gray-600">Copia e Cola:</p>
          <div class="flex gap-2">
            <input id="pix-code" class="border rounded-lg px-3 py-2 flex-1" readonly>
            <button id="copy-pix" type="button" class="px-4 py-2 rounded-lg bg-gray-900 text-white">Copiar</button>
          </div>
        </div>
        <div id="pay-card" class="space-y-2 hidden">
          <input id="card-number" class="border rounded-lg px-3 py-2 w-full" placeholder="Número do cartão">
          <div class="grid grid-cols-2 gap-2">
            <input id="card-exp" class="border rounded-lg px-3 py-2" placeholder="MM/AA" maxlength="5">
            <input id="card-cvv" class="border rounded-lg px-3 py-2" placeholder="CVV" maxlength="4">
          </div>
          <input id="card-name" class="border rounded-lg px-3 py-2 w-full" placeholder="Nome impresso no cartão">
          <button id="pay-card-btn" type="button" class="btn-primary justify-center w-full">Pagar com Cartão</button>
        </div>
      </div>

      <div class="flex items-center justify-between">
        <a id="whats-link" href="#" target="_blank" class="text-sm underline text-gray-600">Enviar resumo pelo WhatsApp</a>
        <button id="finish" type="submit" class="btn-primary"><i class="fa-solid fa-check"></i> Confirmar Pedido</button>
      </div>
    </form>

    <p class="text-center text-xs text-gray-500 mt-6">Ambiente de demonstração — nenhuma transação real será processada.</p>
  </main>

  <div id="toasts" class="fixed bottom-4 right-4 z-[60] space-y-2"></div>

  <script>
    const byId = (id)=> document.getElementById(id);
    const fmt = (n)=> n.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    const toast = (msg, type='info')=>{
      const el = document.createElement('div');
      el.className = 'bg-white border rounded-xl px-4 py-3 text-sm shadow-md ' + (type==='error'?'border-red-200':'border-gray-200');
      el.textContent = msg;
      byId('toasts').appendChild(el);
      setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translateY(6px)'; el.style.transition='all .2s'; setTimeout(()=>el.remove(), 220); }, 2400);
    };

    const order = JSON.parse(localStorage.getItem('order_info')||'{}');
    const cart = order.items || JSON.parse(localStorage.getItem('cart')||'[]');
    let shipping = order.shipping || {price:0, days:0, cep:''};

    function renderSummary(){
      const wrap = byId('order-summary');
      if(!cart.length){ wrap.innerHTML = '<p class="text-gray-500">Seu carrinho está vazio.</p>'; }
      else{
        let html = '<ul class="divide-y">';
        let subtotal = 0;
        cart.forEach(i=>{ subtotal += i.preco * (i.qty||i.quantidade||1); html += `<li class="py-2 flex items-center justify-between"><span>${(i.qty||i.quantidade||1)}x ${i.nome}</span><span>${fmt(i.preco)}</span></li>`; });
        html += '</ul>';
        wrap.innerHTML = html;
        const total = subtotal + (shipping.price||0);
        byId('order-total').textContent = fmt(total);
        byId('frete-val').textContent = fmt(shipping.price||0);
        byId('frete-days').textContent = (shipping.days||0) + ' dia(s)';
        byId('frete-info').classList.toggle('hidden', !(shipping.price));
        updatePix(total);
        updateWhats(total);
      }
    }

    function maskCEP(v){ v=v.replace(/\D/g,''); if(v.length>5) v=v.slice(0,5)+'-'+v.slice(5,8); return v; }
    function estimateShipping(cep){
      const only = cep.replace(/\D/g,'');
      if(only.length!==8) return null;
      const d = parseInt(only[0]);
      if(d<=1) return {price:24.9, days:2, cep};
      if(d<=3) return {price:29.9, days:3, cep};
      if(d<=6) return {price:34.9, days:5, cep};
      return {price:44.9, days:7, cep};
    }

    function updatePix(total){
      const code = `00020126580014BR.GOV.BCB.PIX520400005303986540${String(total.toFixed(2)).replace('.','')}5802BR5915HC Multimarcas6009Sao Paulo62100506HC1234`;
      byId('pix-code').value = code;
    }

    function updateWhats(total){
      const items = cart.map(i=>`${(i.qty||i.quantidade||1)}x ${i.nome} (${fmt(i.preco)})`).join('%0A');
      const txt = `Pedido HC Multimarcas:%0A${items}%0ASubtotal: ${fmt(total - (shipping.price||0))}%0AFrete: ${fmt(shipping.price||0)}%0ATotal: ${fmt(total)}%0ACEP: ${shipping.cep||''}`;
      byId('whats-link').href = `https://wa.me/554899143649?text=${txt}`;
    }

    // Eventos
    byId('cep2').addEventListener('input', (e)=> e.target.value = maskCEP(e.target.value));
    byId('calc-frete').addEventListener('click', ()=>{
      const est = estimateShipping(byId('cep2').value);
      if(!est){ toast('CEP inválido', 'error'); return; }
      shipping = est;
      byId('frete-info').classList.remove('hidden');
      byId('frete-val').textContent = fmt(est.price);
      byId('frete-days').textContent = est.days+' dia(s)';
      const subtotal = cart.reduce((s,i)=> s + i.preco * (i.qty||i.quantidade||1), 0);
      byId('order-total').textContent = fmt(subtotal + est.price);
      updatePix(subtotal + est.price);
      updateWhats(subtotal + est.price);
      localStorage.setItem('order_info', JSON.stringify({items:cart, shipping:est, subtotal}));
    });

    // Tabs de pagamento
    document.querySelectorAll('[data-paytab]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const tab = btn.dataset.paytab;
        document.querySelectorAll('[data-paytab]').forEach(b=>{
          const active = b.dataset.paytab===tab;
          b.classList.toggle('bg-gray-900', active);
          b.classList.toggle('text-white', active);
          b.classList.toggle('bg-gray-100', !active);
        });
        byId('pay-pix').classList.toggle('hidden', tab!=='pix');
        byId('pay-card').classList.toggle('hidden', tab!=='card');
      });
    });

    byId('copy-pix').addEventListener('click', ()=>{
      navigator.clipboard.writeText(byId('pix-code').value);
      toast('Pix copiado!');
    });

    function luhnOk(num){
      const s = num.replace(/\D/g,''); let sum = 0; let dbl=false;
      for(let i=s.length-1;i>=0;i--){ let d = parseInt(s[i]); if(dbl){ d*=2; if(d>9) d-=9 } sum+=d; dbl=!dbl; }
      return (sum%10)===0 && s.length>=13;
    }

    byId('pay-card-btn')?.addEventListener('click', ()=>{
      const num = byId('card-number').value;
      if(!luhnOk(num)){ toast('Número de cartão inválido', 'error'); return; }
      toast('Cartão aprovado!');
    });

    byId('payment-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      if(!cart.length){ toast('Carrinho vazio', 'error'); return; }
      const nome = byId('nome').value.trim();
      const email = byId('email').value.trim();
      const cep = byId('cep2').value.trim();
      if(!nome || !email || !cep){ toast('Preencha os dados obrigatórios', 'error'); return; }
      toast('Pedido confirmado!');
      // Limpar carrinho e voltar para a loja
      localStorage.removeItem('cart');
      localStorage.removeItem('order_info');
      setTimeout(()=>{ window.location.href = 'index.html'; }, 1200);
    });

    renderSummary();
  </script>
</body>
</html>
